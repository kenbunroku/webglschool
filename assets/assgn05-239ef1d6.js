import"./modulepreload-polyfill-3cfb730f.js";import{G as m}from"./lil-gui.esm-aba6213a.js";class h{static loadFile(t){return new Promise((i,r)=>{fetch(t).then(e=>e.text()).then(e=>{i(e)}).catch(e=>{r(e)})})}static createWebGLContext(t){const i=t.getContext("webgl");if(i==null)throw new Error("webgl not supported");return i}static createShaderObject(t,i,r){const e=t.createShader(r);if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw new Error(t.getShaderInfoLog(e))}static createProgramObject(t,i,r){const e=t.createProgram();if(t.attachShader(e,i),t.attachShader(e,r),t.linkProgram(e),t.deleteShader(i),t.deleteShader(r),t.getProgramParameter(e,t.LINK_STATUS))return t.useProgram(e),e;throw new Error(t.getProgramInfoLog(e))}static createVBO(t,i){const r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),r}static enableAttribute(t,i,r,e){t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,e,t.FLOAT,!1,0,0)}}window.addEventListener("DOMContentLoaded",()=>{const c=new f;c.init(),c.load().then(()=>{c.setupGeometry(),c.setupLocation(),c.start()})},!1);class f{constructor(){this.canvas=null,this.gl=null,this.program=null,this.uniformLocation=null,this.positionArray=null,this.positionStride=null,this.params={petals:5,width:.5,numOfQuads:5,power:3},this.color=null,this.colorStride=null,this.colorVBO=null,this.startTime=null,this.isRender=!1,this.render=this.render.bind(this)}init(){this.canvas=document.getElementById("webgl-canvas"),this.gl=h.createWebGLContext(this.canvas);const t=Math.min(window.innerWidth,window.innerHeight);this.canvas.width=t,this.canvas.height=t;const i=new m;i.add(this.params,"petals",0,10).step(1),i.add(this.params,"width",0,1),i.add(this.params,"numOfQuads",0,20),i.add(this.params,"power",0,10).step(.01)}load(){return new Promise((t,i)=>{const r=this.gl;if(r==null){const e=new Error("not initialized");i(e)}else{let e=null,n=null;h.loadFile("./shader/main.vert").then(l=>(e=h.createShaderObject(r,l,r.VERTEX_SHADER),h.loadFile("./shader/main.frag"))).then(l=>{n=h.createShaderObject(r,l,r.FRAGMENT_SHADER),this.program=h.createProgramObject(r,e,n),t()})}})}setupGeometry(){const t=this.params.numOfQuads,i=this.params.petals,r=1/t,e=[],n=[];this.positionArray=[];for(let a=0;a<i;a++){let s=2*Math.PI/i*a;for(let d=0;d<t;d++){let o=d/t;e.push([o,s,0],[o+r,s,0],[o,s,-1]),e.push([o,s,0],[o+r,s,0],[o,s,1]),e.push([o+r,s,0],[o,s,-1],[o+r,s,-1]),e.push([o+r,s,0],[o,s,1],[o+r,s,1])}}for(let a of e){const s=a[0],d=1-Math.pow(s,this.params.power);let o=a[1]+this.params.width*d*a[2];n.push([s*Math.cos(o),s*Math.sin(o),a[2]])}const l=n.length/3;for(let a=0;a<l;a++){const s=a*3,d=n[s],o=n[s+1],u=n[s+2],p=[].concat(d,o,u);this.positionArray.push(p)}this.positionStride=3,this.color=[1,0,0,1,0,1,0,1,0,0,1,1],this.colorStride=4,this.colorVBO=h.createVBO(this.gl,this.color)}setupLocation(){const t=this.gl;this.uniformLocation={time:t.getUniformLocation(this.program,"time")}}setupRendering(){const t=this.gl;t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(.3,.3,.3,1),t.clear(t.COLOR_BUFFER_BIT)}start(){this.startTime=Date.now(),this.isRender=!0,this.render()}render(){const t=this.gl;this.isRender===!0&&requestAnimationFrame(this.render),this.setupRendering();const i=(Date.now()-this.startTime)*.001;t.useProgram(this.program),t.uniform1f(this.uniformLocation.time,i);for(let r=0;r<this.positionArray.length;r++){const e=this.positionArray[r],n=h.createVBO(this.gl,e),l=t.getAttribLocation(this.program,"position"),a=t.getAttribLocation(this.program,"color");h.enableAttribute(t,n,l,this.positionStride),h.enableAttribute(t,this.colorVBO,a,this.colorStride),t.drawArrays(t.TRIANGLES,0,e.length/this.positionStride)}}}
