import"./modulepreload-polyfill-3cfb730f.js";import"./tweakpane-a93a1018.js";class B{static loadFile(t){return new Promise((e,s)=>{fetch(t).then(i=>i.text()).then(i=>{e(i)}).catch(i=>{s(i)})})}static loadImage(t){return new Promise(e=>{const s=new Image;s.addEventListener("load",()=>{e(s)},!1),s.addEventListener("error",i=>{reject(new Error(`Failed to load image at path: ${t}`))},!1),s.src=t})}static loadImages(t){return Promise.all(t.map(e=>B.loadImage(e)))}static createWebGLContext(t){const e=t.getContext("webgl");if(e==null)throw new Error("webgl not supported");return e}static createShaderObject(t,e,s){const i=t.createShader(s);if(t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;throw new Error(t.getShaderInfoLog(i))}static createProgramObject(t,e,s){const i=t.createProgram();if(t.attachShader(i,e),t.attachShader(i,s),t.linkProgram(i),t.deleteShader(e),t.deleteShader(s),t.getProgramParameter(i,t.LINK_STATUS))return t.useProgram(i),i;throw new Error(t.getProgramInfoLog(i))}static createVBO(t,e){const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s}static createIBO(t,e){const s=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Int16Array(e),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),s}static enableBuffer(t,e,s,i,n){for(let r=0;r<e.length;++r)t.bindBuffer(t.ARRAY_BUFFER,e[r]),t.enableVertexAttribArray(s[r]),t.vertexAttribPointer(s[r],i[r],t.FLOAT,!1,0,0);n!=null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}static createTexture(t,e){const s=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),s}static createTextures(t,e){const s=[];for(let i=0;i<e.length;++i)s.push(this.createTexture(t,e[i]));return s}static createFramebuffer(t,e,s){const i=t.createFramebuffer(),n=t.createRenderbuffer(),r=t.createTexture();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,s,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),{framebuffer:i,depthRenderbuffer:n,texture:r}}static deleteFramebuffer(t,e,s,i){t.deleteFramebuffer(e),t.deleteRenderbuffer(s),t.deleteTexture(i),e=null,s=null,i=null}}class Y{static get Vec2(){return W}static get Vec3(){return $}static get Mat4(){return Q}static get Qtn(){return Z}}let W=class k{static create(t=0,e=0){const s=new Float32Array(2);return s[0]=t,s[1]=e,s}static length(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}static normalize(t){const e=k.create(),s=k.length(t);if(s>0){const i=1/s;e[0]=t[0]*i,e[1]=t[1]*i}return e}static dot(t,e){return t[0]*e[0]+t[1]*e[1]}static cross(t,e){return k.create(),t[0]*e[1]-t[1]*e[0]}},$=class z{static create(t=0,e=0,s=0){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=s,i}static length(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}static subtract(t,e){const s=z.create();return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],s}static normalize(t){const e=z.create(),s=z.length(t);if(s>0){const i=1/s;e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}return e}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static cross(t,e){return z.create(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])}static faceNormal(t,e,s){const i=z.create(e[0]-t[0],e[1]-t[1],e[2]-t[2]),n=z.create(s[0]-t[0],s[1]-t[1],s[2]-t[2]),r=z.create(i[1]*n[2]-i[2]*n[1],i[2]*n[0]-i[0]*n[2],i[0]*n[1]-i[1]*n[0]);return z.normalize(r)}},Q=class _{static create(){return new Float32Array(16)}static identity(t){const e=t??_.create();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}static multiply(t,e,s){const i=s??_.create(),n=t[0],r=t[1],o=t[2],a=t[3],u=t[4],c=t[5],f=t[6],h=t[7],E=t[8],p=t[9],d=t[10],l=t[11],M=t[12],A=t[13],x=t[14],I=t[15],b=e[0],P=e[1],T=e[2],R=e[3],U=e[4],y=e[5],F=e[6],L=e[7],w=e[8],S=e[9],C=e[10],D=e[11],X=e[12],O=e[13],g=e[14],H=e[15];return i[0]=b*n+P*u+T*E+R*M,i[1]=b*r+P*c+T*p+R*A,i[2]=b*o+P*f+T*d+R*x,i[3]=b*a+P*h+T*l+R*I,i[4]=U*n+y*u+F*E+L*M,i[5]=U*r+y*c+F*p+L*A,i[6]=U*o+y*f+F*d+L*x,i[7]=U*a+y*h+F*l+L*I,i[8]=w*n+S*u+C*E+D*M,i[9]=w*r+S*c+C*p+D*A,i[10]=w*o+S*f+C*d+D*x,i[11]=w*a+S*h+C*l+D*I,i[12]=X*n+O*u+g*E+H*M,i[13]=X*r+O*c+g*p+H*A,i[14]=X*o+O*f+g*d+H*x,i[15]=X*a+O*h+g*l+H*I,i}static scale(t,e,s){const i=s??_.create();return i[0]=t[0]*e[0],i[1]=t[1]*e[0],i[2]=t[2]*e[0],i[3]=t[3]*e[0],i[4]=t[4]*e[1],i[5]=t[5]*e[1],i[6]=t[6]*e[1],i[7]=t[7]*e[1],i[8]=t[8]*e[2],i[9]=t[9]*e[2],i[10]=t[10]*e[2],i[11]=t[11]*e[2],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}static translate(t,e,s){const i=s??_.create();return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],i[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],i[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],i[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],i}static rotate(t,e,s,i){let n=i??_.create();const r=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);if(!r)return null;let o=s[0],a=s[1],u=s[2];if(r!=1){const O=1/r;o*=O,a*=O,u*=O}const c=Math.sin(e),f=Math.cos(e),h=1-f,E=t[0],p=t[1],d=t[2],l=t[3],M=t[4],A=t[5],x=t[6],I=t[7],b=t[8],P=t[9],T=t[10],R=t[11],U=o*o*h+f,y=a*o*h+u*c,F=u*o*h-a*c,L=o*a*h-u*c,w=a*a*h+f,S=u*a*h+o*c,C=o*u*h+a*c,D=a*u*h-o*c,X=u*u*h+f;return e?t!=n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=E*U+M*y+b*F,n[1]=p*U+A*y+P*F,n[2]=d*U+x*y+T*F,n[3]=l*U+I*y+R*F,n[4]=E*L+M*w+b*S,n[5]=p*L+A*w+P*S,n[6]=d*L+x*w+T*S,n[7]=l*L+I*w+R*S,n[8]=E*C+M*D+b*X,n[9]=p*C+A*D+P*X,n[10]=d*C+x*D+T*X,n[11]=l*C+I*D+R*X,n}static lookAt(t,e,s,i){const n=i??_.create(),r=t[0],o=t[1],a=t[2],u=e[0],c=e[1],f=e[2],h=s[0],E=s[1],p=s[2];if(r==u&&o==c&&a==f)return _.identity(n);let d,l,M,A,x,I,b,P,T,R;return b=r-u,P=o-c,T=a-f,R=1/Math.sqrt(b*b+P*P+T*T),b*=R,P*=R,T*=R,d=E*T-p*P,l=p*b-h*T,M=h*P-E*b,R=Math.sqrt(d*d+l*l+M*M),R?(R=1/R,d*=R,l*=R,M*=R):(d=0,l=0,M=0),A=P*M-T*l,x=T*d-b*M,I=b*l-P*d,R=Math.sqrt(A*A+x*x+I*I),R?(R=1/R,A*=R,x*=R,I*=R):(A=0,x=0,I=0),n[0]=d,n[1]=A,n[2]=b,n[3]=0,n[4]=l,n[5]=x,n[6]=P,n[7]=0,n[8]=M,n[9]=I,n[10]=T,n[11]=0,n[12]=-(d*r+l*o+M*a),n[13]=-(A*r+x*o+I*a),n[14]=-(b*r+P*o+T*a),n[15]=1,n}static perspective(t,e,s,i,n){const r=n??_.create(),o=s*Math.tan(t*Math.PI/360),u=o*e*2,c=o*2,f=i-s;return r[0]=s*2/u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2/c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-(i+s)/f,r[11]=-1,r[12]=0,r[13]=0,r[14]=-(i*s*2)/f,r[15]=0,r}static ortho(t,e,s,i,n,r,o){const a=o??_.create(),u=e-t,c=s-i,f=r-n;return a[0]=2/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/c,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/f,a[11]=0,a[12]=-(t+e)/u,a[13]=-(s+i)/c,a[14]=-(r+n)/f,a[15]=1,a}static transpose(t,e){const s=e??_.create();return s[0]=t[0],s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=t[1],s[5]=t[5],s[6]=t[9],s[7]=t[13],s[8]=t[2],s[9]=t[6],s[10]=t[10],s[11]=t[14],s[12]=t[3],s[13]=t[7],s[14]=t[11],s[15]=t[15],s}static inverse(t,e){const s=e??_.create(),i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],u=t[5],c=t[6],f=t[7],h=t[8],E=t[9],p=t[10],d=t[11],l=t[12],M=t[13],A=t[14],x=t[15],I=i*u-n*a,b=i*c-r*a,P=i*f-o*a,T=n*c-r*u,R=n*f-o*u,U=r*f-o*c,y=h*M-E*l,F=h*A-p*l,L=h*x-d*l,w=E*A-p*M,S=E*x-d*M,C=p*x-d*A,D=1/(I*C-b*S+P*w+T*L-R*F+U*y);return s[0]=(u*C-c*S+f*w)*D,s[1]=(-n*C+r*S-o*w)*D,s[2]=(M*U-A*R+x*T)*D,s[3]=(-E*U+p*R-d*T)*D,s[4]=(-a*C+c*L-f*F)*D,s[5]=(i*C-r*L+o*F)*D,s[6]=(-l*U+A*P-x*b)*D,s[7]=(h*U-p*P+d*b)*D,s[8]=(a*S-u*L+f*y)*D,s[9]=(-i*S+n*L-o*y)*D,s[10]=(l*R-M*P+x*I)*D,s[11]=(-h*R+E*P-d*I)*D,s[12]=(-a*w+u*F-c*y)*D,s[13]=(i*w-n*F+r*y)*D,s[14]=(-l*T+M*b-A*I)*D,s[15]=(h*T-E*b+p*I)*D,s}static toVecIV(t,e){const s=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],u=t[6],c=t[7],f=t[8],h=t[9],E=t[10],p=t[11],d=t[12],l=t[13],M=t[14],A=t[15],x=e[0],I=e[1],b=e[2],P=e[3],T=new Float32Array(4);return T[0]=x*s+I*o+b*f+P*d,T[1]=x*i+I*a+b*h+P*l,T[2]=x*n+I*u+b*E+P*M,T[3]=x*r+I*c+b*p+P*A,T}static screenPositionFromMvp(t,e,s,i){const n=s*.5,r=i*.5,o=_.toVecIV(t,[e[0],e[1],e[2],1]);if(o[3]<=0)return[NaN,NaN];o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];const a=W.create();return a[0]=n+o[0]*n,a[1]=r-o[1]*r,a}},Z=class v{static create(){return new Float32Array(4)}static identity(t){const e=t??v.create();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}static inverse(t,e){const s=e??v.create();return s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s[3]=t[3],s}static normalize(t){const e=v.create(),s=t[0],i=t[1],n=t[2],r=Math.sqrt(s*s+i*i+n*n);if(r>0){const o=1/r;e[0]=s*o,e[1]=i*o,e[2]=n*o}return e}static multiply(t,e,s){const i=s??v.create(),n=t[0],r=t[1],o=t[2],a=t[3],u=e[0],c=e[1],f=e[2],h=e[3];return i[0]=n*h+a*u+r*f-o*c,i[1]=r*h+a*c+o*u-n*f,i[2]=o*h+a*f+n*c-r*u,i[3]=a*h-n*u-r*c-o*f,i}static rotate(t,e,s){const i=s??v.create();let n=e[0],r=e[1],o=e[2];const a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(a!==0){const c=1/a;n*=c,r*=c,o*=c}const u=Math.sin(t*.5);return i[0]=n*u,i[1]=r*u,i[2]=o*u,i[3]=Math.cos(t*.5),i}static toVecIII(t,e,s){const i=s??$.create(),n=v.create(),r=v.create(),o=v.create();return v.inverse(e,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],v.multiply(o,n,r),v.multiply(r,e,o),i[0]=o[0],i[1]=o[1],i[2]=o[2],i}static toMatIV(t,e){const s=e??Q.create(),i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,u=n+n,c=r+r,f=i*a,h=i*u,E=i*c,p=n*u,d=n*c,l=r*c,M=o*a,A=o*u,x=o*c;return s[0]=1-(p+l),s[1]=h-x,s[2]=E+A,s[3]=0,s[4]=h+x,s[5]=1-(f+l),s[6]=d-M,s[7]=0,s[8]=E-A,s[9]=d+M,s[10]=1-(f+p),s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}static slerp(t,e,s,i){const n=i??v.create(),r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];let o=1-r*r;if(o<=0)n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3];else if(o=Math.sqrt(o),Math.abs(o)<1e-4)n[0]=t[0]*.5+e[0]*.5,n[1]=t[1]*.5+e[1]*.5,n[2]=t[2]*.5+e[2]*.5,n[3]=t[3]*.5+e[3]*.5;else{const a=Math.acos(r),u=a*s,c=Math.sin(a-u)/o,f=Math.sin(u)/o;n[0]=t[0]*c+e[0]*f,n[1]=t[1]*c+e[1]*f,n[2]=t[2]*c+e[2]*f,n[3]=t[3]*c+e[3]*f}return n}};class K{static plane(t,e,s){const i=t/2,n=e/2,r=[-i,n,0,i,n,0,-i,-n,0,i,-n,0],o=[0,0,1,0,0,1,0,0,1,0,0,1],a=[s[0],s[1],s[2],s[3],s[0],s[1],s[2],s[3],s[0],s[1],s[2],s[3],s[0],s[1],s[2],s[3]];return{position:r,normal:o,color:a,texCoord:[0,0,1,0,0,1,1,1],index:[0,2,1,1,2,3]}}static circle(t,e,s){const i=[],n=[],r=[],o=[],a=[];i.push(0,0,0),n.push(0,0,1),r.push(s[0],s[1],s[2],s[3]),o.push(.5,.5);let u=0;for(let c=0;c<t;c++){const f=Math.PI*2/t*c,h=Math.cos(f),E=Math.sin(f);i.push(h*e,E*e,0),n.push(0,0,1),r.push(s[0],s[1],s[2],s[3]),o.push((h+1)*.5,1-(E+1)*.5),c===t-1?a.push(0,u+1,1):a.push(0,u+1,u+2),++u}return{position:i,normal:n,color:r,texCoord:o,index:a}}static cube(t,e){const s=t*.5,i=[-s,-s,s,s,-s,s,s,s,s,-s,s,s,-s,-s,-s,-s,s,-s,s,s,-s,s,-s,-s,-s,s,-s,-s,s,s,s,s,s,s,s,-s,-s,-s,-s,s,-s,-s,s,-s,s,-s,-s,s,s,-s,-s,s,s,-s,s,s,s,s,-s,s,-s,-s,-s,-s,-s,s,-s,s,s,-s,s,-s],n=1/Math.sqrt(3),r=[-n,-n,n,n,-n,n,n,n,n,-n,n,n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n,-n,-n,n,-n,-n,n,n,n,n,n,n,n,-n,-n,-n,-n,n,-n,-n,n,-n,n,-n,-n,n,n,-n,-n,n,n,-n,n,n,n,n,-n,n,-n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n],o=[];for(let c=0;c<i.length/3;c++)o.push(e[0],e[1],e[2],e[3]);return{position:i,normal:r,color:o,texCoord:[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],index:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}static cone(t,e,s,i){const n=[],r=[],o=[],a=[],u=[],c=s/2;n.push(0,-c,0),r.push(0,-1,0),o.push(i[0],i[1],i[2],i[3]),a.push(.5,.5);let f=0;for(let h=0;h<=t;h++){const E=Math.PI*2/t*h,p=Math.cos(E),d=Math.sin(E);n.push(p*e,-c,d*e,p*e,-c,d*e),r.push(0,-1,0,p,0,d),o.push(i[0],i[1],i[2],i[3],i[0],i[1],i[2],i[3]),a.push((p+1)*.5,1-(d+1)*.5,(p+1)*.5,1-(d+1)*.5),h!==t&&(u.push(0,f+1,f+3),u.push(f+4,f+2,t*2+3)),f+=2}return n.push(0,c,0),r.push(0,1,0),o.push(i[0],i[1],i[2],i[3]),a.push(.5,.5),{position:n,normal:r,color:o,texCoord:a,index:u}}static cylinder(t,e,s,i,n){const r=[],o=[],a=[],u=[],c=[],f=i/2;r.push(0,f,0,0,-f,0),o.push(0,1,0,0,-1,0),a.push(n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3]),u.push(.5,.5,.5,.5);let h=2;for(let E=0;E<=t;E++){const p=Math.PI*2/t*E,d=Math.cos(p),l=Math.sin(p);r.push(d*e,f,l*e,d*e,f,l*e,d*s,-f,l*s,d*s,-f,l*s),o.push(0,1,0,d,0,l,0,-1,0,d,0,l),a.push(n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3]),u.push((d+1)*.5,1-(l+1)*.5,1-E/t,0,(d+1)*.5,1-(l+1)*.5,1-E/t,1),E!==t&&c.push(0,h+4,h,1,h+2,h+6,h+5,h+7,h+1,h+1,h+7,h+3),h+=4}return{position:r,normal:o,color:a,texCoord:u,index:c}}static sphere(t,e,s,i){const n=[],r=[],o=[],a=[],u=[];for(let c=0;c<=t;c++){const f=Math.PI/t*c,h=Math.cos(f),E=Math.sin(f);for(let p=0;p<=e;p++){const d=Math.PI*2/e*p,l=E*s*Math.cos(d),M=h*s,A=E*s*Math.sin(d),x=E*Math.cos(d),I=E*Math.sin(d);n.push(l,M,A),r.push(x,h,I),o.push(i[0],i[1],i[2],i[3]),a.push(1-1/e*p,1/t*c)}}for(let c=0;c<t;c++)for(let f=0;f<e;f++){const h=(e+1)*c+f;u.push(h,h+1,h+e+2),u.push(h,h+e+2,h+e+1)}return{position:n,normal:r,color:o,texCoord:a,index:u}}static torus(t,e,s,i,n){const r=[],o=[],a=[],u=[],c=[];for(let f=0;f<=t;f++){const h=Math.PI*2/t*f,E=Math.cos(h),p=Math.sin(h);for(let d=0;d<=e;d++){const l=Math.PI*2/e*d,M=(E*s+i)*Math.cos(l),A=p*s,x=(E*s+i)*Math.sin(l),I=E*Math.cos(l),b=E*Math.sin(l),P=1/e*d;let T=1/t*f+.5;T>1&&(T-=1),T=1-T,r.push(M,A,x),o.push(I,p,b),a.push(n[0],n[1],n[2],n[3]),u.push(P,T)}}for(let f=0;f<t;f++)for(let h=0;h<e;h++){const E=(e+1)*f+h;c.push(E,E+e+1,E+1),c.push(E+e+1,E+e+2,E+1)}return{position:r,normal:o,color:a,texCoord:u,index:c}}static icosahedron(t,e){const s=(1+Math.sqrt(5))/2,i=s*t,n=Math.sqrt(1+s*s),r=[1/n,s/n],o=[-t,i,0,t,i,0,-t,-i,0,t,-i,0,0,-t,i,0,t,i,0,-t,-i,0,t,-i,i,0,-t,i,0,t,-i,0,-t,-i,0,t],a=[-r[0],r[1],0,r[0],r[1],0,-r[0],-r[1],0,r[0],-r[1],0,0,-r[0],r[1],0,r[0],r[1],0,-r[0],-r[1],0,r[0],-r[1],r[1],0,-r[0],r[1],0,r[0],-r[1],0,-r[0],-r[1],0,r[0]],u=[e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3]],c=[];for(let h=0,E=a.length;h<E;h+=3){const p=(Math.atan2(a[h+2],-a[h])+Math.PI)/(Math.PI*2),d=1-(a[h+1]+1)/2;c.push(p,d)}return{position:o,normal:a,color:u,texCoord:c,index:[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}}}const j=Y.Vec2,N=Y.Vec3,J=Y.Mat4,m=Y.Qtn;class G{static get DEFAULT_DISTANCE(){return 5}static get DEFAULT_MIN_DISTANCE(){return 1}static get DEFAULT_MAX_DISTANCE(){return 10}static get DEFAULT_MOVE_SCALE(){return 2}constructor(t,e={}){this.target=t,this.distance=e.distance||G.DEFAULT_DISTANCE,this.minDistance=e.min||G.DEFAULT_MIN_DISTANCE,this.maxDistance=e.max||G.DEFAULT_MAX_DISTANCE,this.moveScale=e.move||G.DEFAULT_MOVE_SCALE,this.position=N.create(0,0,this.distance),this.center=N.create(0,0,0),this.upDirection=N.create(0,1,0),this.defaultPosition=N.create(0,0,this.distance),this.defaultCenter=N.create(0,0,0),this.defaultUpDirection=N.create(0,1,0),this.movePosition=N.create(0,0,0),this.rotateX=0,this.rotateY=0,this.scale=0,this.isDown=!1,this.prevPosition=j.create(0,0),this.offsetPosition=j.create(0,0),this.qt=m.create(),this.qtx=m.create(),this.qty=m.create(),this.mouseInteractionStart=this.mouseInteractionStart.bind(this),this.mouseInteractionMove=this.mouseInteractionMove.bind(this),this.mouseInteractionEnd=this.mouseInteractionEnd.bind(this),this.wheelScroll=this.wheelScroll.bind(this),this.target.addEventListener("mousedown",this.mouseInteractionStart,!1),this.target.addEventListener("mousemove",this.mouseInteractionMove,!1),this.target.addEventListener("mouseup",this.mouseInteractionEnd,!1),this.target.addEventListener("wheel",this.wheelScroll,!1),this.target.addEventListener("contextmenu",s=>{s.preventDefault()},!1)}setPosition(t){this.defaultPosition=t}mouseInteractionStart(t){this.isDown=!0;const e=this.target.getBoundingClientRect();this.prevPosition=j.create(t.clientX-e.left,t.clientY-e.top)}mouseInteractionMove(t){if(this.isDown!==!0)return;const e=this.target.getBoundingClientRect(),s=e.width,i=e.height,n=t.clientX-e.left,r=t.clientY-e.top,o=1/Math.min(s,i);switch(this.offsetPosition=j.create(n-this.prevPosition[0],r-this.prevPosition[1]),this.prevPosition=j.create(n,r),t.buttons){case 1:this.rotateX+=this.offsetPosition[0]*o,this.rotateY+=this.offsetPosition[1]*o,this.rotateX=this.rotateX%1,this.rotateY=Math.min(Math.max(this.rotateY%1,-.25),.25);break;case 2:const a=N.create(this.offsetPosition[0],-this.offsetPosition[1],0),u=m.toVecIII(a,this.qt);this.movePosition[0]-=u[0]*o*this.moveScale,this.movePosition[1]-=u[1]*o*this.moveScale,this.movePosition[2]-=u[2]*o*this.moveScale;break}}mouseInteractionEnd(t){this.isDown=!1}wheelScroll(t){const e=t.wheelDelta;e>0?this.scale=-.5:e<0&&(this.scale=.5)}update(){const t=Math.PI*2,e=N.create(1,0,0),s=N.create(0,1,0);return this.scale*=.7,this.distance+=this.scale,this.distance=Math.min(Math.max(this.distance,this.minDistance),this.maxDistance),this.defaultPosition[2]=this.distance,m.identity(this.qt),m.identity(this.qtx),m.identity(this.qty),m.rotate(this.rotateX*t,s,this.qtx),m.toVecIII(e,this.qtx,e),m.rotate(this.rotateY*t,e,this.qty),m.multiply(this.qtx,this.qty,this.qt),m.toVecIII(this.defaultPosition,this.qt,this.position),m.toVecIII(this.defaultUpDirection,this.qt,this.upDirection),this.position[0]+=this.movePosition[0],this.position[1]+=this.movePosition[1],this.position[2]+=this.movePosition[2],this.center[0]=this.defaultCenter[0]+this.movePosition[0],this.center[1]=this.defaultCenter[1]+this.movePosition[1],this.center[2]=this.defaultCenter[2]+this.movePosition[2],J.lookAt(this.position,this.center,this.upDirection)}}var q=`attribute vec3 position;
attribute vec3 normal;
attribute vec2 texCoord;
attribute vec4 color;

uniform mat4 mMatrix;
uniform mat4 mvpMatrix;

varying vec2 vTexCoord;
varying vec3 vNormal;
varying vec4 vColor;

void main() {
    vNormal = normal;

    vTexCoord = texCoord;

    vColor = color;

    gl_Position = mvpMatrix * vec4(position, 1.0);
}`,tt=`precision mediump float;

uniform sampler2D textureUnit;
uniform mat4 normalMatrix;

varying vec3 vNormal;
varying vec2 vTexCoord;
varying vec4 vColor;

const vec3 light = vec3(1.0, 2.0, 2.0);

void main() {
    vec3 n = (normalMatrix * vec4(vNormal, 0.0)).xyz;

    vec4 textureColor = texture2D(textureUnit, vTexCoord);

    float d = dot(normalize(n), normalize(light)) * 0.7;

    gl_FragColor = vec4(textureColor.rgb, textureColor.a);
}`;window.addEventListener("DOMContentLoaded",()=>{const V=new et;V.init(),V.load().then(()=>{V.setupGeometry(),V.setupLocation(),V.start()})},!1);class et{constructor(){this.canvas=null,this.gl=null,this.renderProgram=null,this.offscreenProgram=null,this.renderAttLocation=null,this.offscreenAttLocation=null,this.renderAttStride=null,this.offscreenAttStride=null,this.renderUniLocation=null,this.planeGeometry=null,this.planeVBO=null,this.planeIBO=null,this.startTime=null,this.camera=null,this.texture=null,this.framebufferObject=null,this.framebufferSize=512,this.isRender=!1,this.textureVisibility=!0,this.resize=this.resize.bind(this),this.render=this.render.bind(this)}setCulling(t){const e=this.gl;e!=null&&(t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE))}setDepthTest(t){const e=this.gl;e!=null&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST))}setTextureVisibility(t){this.textureVisibility=t}init(){this.canvas=document.getElementById("webgl-canvas"),this.gl=B.createWebGLContext(this.canvas);const t={distance:4.5,min:1,max:10,move:2};this.camera=new G(this.canvas,t),this.framebufferObject=B.createFramebuffer(this.gl,this.framebufferSize,this.framebufferSize),this.resize(),window.addEventListener("resize",this.resize,!1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}load(){return new Promise((t,e)=>{const s=this.gl;if(s==null){const i=new Error("not initialized");e(i)}else{let i=B.createShaderObject(s,q,s.VERTEX_SHADER),n=B.createShaderObject(s,tt,s.FRAGMENT_SHADER);this.renderProgram=B.createProgramObject(s,i,n);const r={basePath:location.hostname==="localhost"||location.hostname==="127.0.0.1"?"":"/webglschool"};B.loadImage(`${r.basePath}/img/space.jpg`).then(o=>{this.texture=B.createTexture(s,o),t()})}})}setupGeometry(){const t=[1,1,1,1],e=2;this.planeGeometry=K.plane(e*(this.canvas.width/this.canvas.height),e,t),this.planeVBO=[B.createVBO(this.gl,this.planeGeometry.position),B.createVBO(this.gl,this.planeGeometry.normal),B.createVBO(this.gl,this.planeGeometry.texCoord),B.createVBO(this.gl,this.planeGeometry.color)],this.planeIBO=B.createIBO(this.gl,this.planeGeometry.index)}setupLocation(){const t=this.gl;this.renderAttLocation=[t.getAttribLocation(this.renderProgram,"position"),t.getAttribLocation(this.renderProgram,"normal"),t.getAttribLocation(this.renderProgram,"texCoord"),t.getAttribLocation(this.renderProgram,"color")],this.attributeStride=[3,3,2,4],this.renderUniLocation={mvpMatrix:t.getUniformLocation(this.renderProgram,"mvpMatrix"),normalMatrix:t.getUniformLocation(this.renderProgram,"normalMatrix"),textureUnit:t.getUniformLocation(this.renderProgram,"textureUnit")}}setupRendering(){const t=this.gl;t.viewport(0,0,this.canvas.width,this.canvas.height),t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}start(){this.startTime=Date.now(),this.isRender=!0,this.render()}stop(){this.isRender=!1}render(){const t=this.gl,e=Y.Mat4;this.isRender&&requestAnimationFrame(this.render);const s=(Date.now()-this.startTime)*1e-4;this.setupRendering();const i=e.identity(),n=this.camera.update(),r=2*(180/Math.PI)*Math.atan(2/(2*this.camera.distance)),o=this.canvas.width/this.canvas.height,a=.1,u=10,c=e.perspective(r,o,a,u),f=e.multiply(c,n),h=e.multiply(f,i),E=e.transpose(e.inverse(i));t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.useProgram(this.renderProgram),t.uniformMatrix4fv(this.renderUniLocation.mvpMatrix,!1,h),t.uniformMatrix4fv(this.renderUniLocation.normalMatrix,!1,E),t.uniform1i(this.renderUniLocation.textureUnit,0),t.uniform1f(this.renderUniLocation.time,s),B.enableBuffer(t,this.planeVBO,this.renderAttLocation,this.attributeStride,this.planeIBO),t.drawElements(t.TRIANGLES,this.planeGeometry.index.length,t.UNSIGNED_SHORT,0)}}
