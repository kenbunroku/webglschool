import{V as l,G as R,L as y,g as M,c as g,F as w,k as E,W as L,C as I,S as P,P as C,D as T,A as x,l as p,i as D,a as N,O as G,m as k,Q as _}from"./OrbitControls-ce48916e.js";import{G as H}from"./lil-gui.esm-aba6213a.js";function S(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(!(t.status===204||t.status===205))return t.json()}function v(t,n){return fetch(t,n).then(S)}function d(t,n,a){this.k=t,this.x=n,this.y=a}d.prototype={constructor:d,scale:function(t){return t===1?this:new d(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new d(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};d.prototype;window.addEventListener("DOMContentLoaded",()=>{const t=new e;t.load().then(()=>{t.init(),t.render()})},!1);class e{static get CAMERA_PARAM(){return{fovy:45,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e4,x:10,y:0,z:2500,lookAt:new l(0,0,0)}}static get RENDERER_PARAM(){return{clearColor:0,width:window.innerWidth,height:window.innerHeight}}static get DIRECTIONAL_LIGHT_PARAM(){return{color:16777215,intensity:1,x:1,y:1,z:1}}static get AMBIENT_LIGHT_PARAM(){return{color:16777215,intensity:.2}}static get MATERIAL_PARAM(){return{color:16777215}}static get AIRPLANE_DISTANCE(){return 1e3}constructor(){this.renderer,this.scene,this.camera,this.controls,this.directionalLight,this.ambientLight,this.axesHelper,this.lines=new R,this.lineMaterial=new y({linewidth:1,color:16777215}),this.countryBoundaries,this.coneGeometry,this.airplane,this.airplaneMaterial,this.airplaneDirection,this.clock=new M,this.render=this.render.bind(this),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()},!1)}createLineFromCoords(n){let a=new g,i=[];for(let h=0;h<n.length;h++){let s=n[h].y,r=n[h].x,o=e.RENDERER_PARAM.height,c=s*(Math.PI/180),A=-r*(Math.PI/180),u=Math.cos(c)*Math.cos(A)*o,f=Math.sin(c)*o,m=Math.cos(c)*Math.sin(A)*o;i.push(u,f,m)}return a.setAttribute("position",new w(i,3)),new E(a,this.lineMaterial)}addGeoJsonFeaturesToScene(n){for(let a=0;a<n.length;a++){let i=n[a],h=[];for(let s=0;s<i.geometry.coordinates.length;s++)if(i.geometry.type==" Polygon"){let r=[];for(let o=0;o<i.geometry.coordinates[s].length;o++){let c={x:i.geometry.coordinates[s][o][0],y:i.geometry.coordinates[s][o][1]};r.push(c)}r.length>0&&this.lines.add(this.coordinatesreateLineFromCoords(r))}else if(i.geometry.type=="MultiPolygon")for(let r=0;r<i.geometry.coordinates[s].length;r++)for(let o=0;o<i.geometry.coordinates[s][r].length;o++)i.geometry.coordinates[s][r][o][0],i.geometry.coordinates[s][r][o][1];else if(i.geometry.type=="LineString"){let r={x:i.geometry.coordinates[s][0],y:i.geometry.coordinates[s][1]};h.push(r)}i.geometry.type=="LineString"&&h.length>0&&this.lines.add(this.createLineFromCoords(h))}this.scene.add(this.lines)}async load(){return this.countryBoundaries=await v("https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_BN_20M_2020_4326.geojson")}async init(){this.renderer=new L,this.renderer.setClearColor(new I(e.RENDERER_PARAM.clearColor)),this.renderer.setSize(e.RENDERER_PARAM.width,e.RENDERER_PARAM.height),document.querySelector("#webgl").appendChild(this.renderer.domElement),this.scene=new P,this.camera=new C(e.CAMERA_PARAM.fovy,e.CAMERA_PARAM.aspect,e.CAMERA_PARAM.near,e.CAMERA_PARAM.far),this.camera.position.set(e.CAMERA_PARAM.x,e.CAMERA_PARAM.y,e.CAMERA_PARAM.z),this.camera.lookAt(e.CAMERA_PARAM.lookAt),this.directionalLight=new T(e.DIRECTIONAL_LIGHT_PARAM.color,e.DIRECTIONAL_LIGHT_PARAM.intensity),this.directionalLight.position.set(e.DIRECTIONAL_LIGHT_PARAM.x,e.DIRECTIONAL_LIGHT_PARAM.y,e.DIRECTIONAL_LIGHT_PARAM.z),this.scene.add(this.directionalLight),this.ambientLight=new x(e.AMBIENT_LIGHT_PARAM.color,e.AMBIENT_LIGHT_PARAM.intensity),this.scene.add(this.ambientLight),this.coneGeometry=new p(10,30,32),this.airplaneMaterial=new D(e.MATERIAL_PARAM),this.airplane=new N(this.coneGeometry,this.airplaneMaterial),this.scene.add(this.airplane),this.airplane.scale.setScalar(3),this.airplane.position.set(e.AIRPLANE_DISTANCE,0,0),this.airplaneDirection=new l(0,1,0).normalize(),new H,this.controls=new G(this.camera,this.renderer.domElement);const a=1e3;this.axesHelper=new k(a),this.scene.add(this.axesHelper),this.addGeoJsonFeaturesToScene(this.countryBoundaries.features)}render(){requestAnimationFrame(this.render),this.controls.update(),this.lines.rotation.y+=.001;const n=this.clock.getElapsedTime(),a=new l(Math.cos(n)*e.AIRPLANE_DISTANCE,0,Math.sin(n)*e.AIRPLANE_DISTANCE),i=this.airplaneDirection.clone(),h=new l().subVectors(a,this.airplane.position);h.normalize(),this.airplaneDirection.add(h),this.airplaneDirection.normalize();const s=this.airplaneDirection.clone();this.airplane.position.add(s.multiplyScalar(15));const r=new l().crossVectors(i,this.airplaneDirection);r.normalize();const o=i.dot(this.airplaneDirection),c=Math.acos(o),A=new _().setFromAxisAngle(r,c);this.airplane.quaternion.premultiply(A),this.renderer.render(this.scene,this.camera)}}
