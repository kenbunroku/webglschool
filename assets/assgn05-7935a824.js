import"./modulepreload-polyfill-3cfb730f.js";import{G as m}from"./lil-gui.esm-aba6213a.js";class h{static loadFile(t){return new Promise((s,r)=>{fetch(t).then(e=>e.text()).then(e=>{s(e)}).catch(e=>{r(e)})})}static createWebGLContext(t){const s=t.getContext("webgl");if(s==null)throw new Error("webgl not supported");return s}static createShaderObject(t,s,r){const e=t.createShader(r);if(t.shaderSource(e,s),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw new Error(t.getShaderInfoLog(e))}static createProgramObject(t,s,r){const e=t.createProgram();if(t.attachShader(e,s),t.attachShader(e,r),t.linkProgram(e),t.deleteShader(s),t.deleteShader(r),t.getProgramParameter(e,t.LINK_STATUS))return t.useProgram(e),e;throw new Error(t.getProgramInfoLog(e))}static createVBO(t,s){const r=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),r}static enableAttribute(t,s,r,e){t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,e,t.FLOAT,!1,0,0)}}window.addEventListener("DOMContentLoaded",()=>{const c=new f;c.init(),c.load().then(()=>{c.setupGeometry(),c.setupLocation(),c.start()})},!1);class f{constructor(){this.canvas=null,this.gl=null,this.program=null,this.uniformLocation=null,this.positionArray=null,this.positionStride=null,this.params={petals:5,width:.5,numOfQuads:5,power:3},this.color=null,this.colorStride=null,this.colorVBO=null,this.startTime=null,this.isRender=!1,this.render=this.render.bind(this)}init(){this.canvas=document.getElementById("webgl-canvas"),this.gl=h.createWebGLContext(this.canvas);const t=Math.min(window.innerWidth,window.innerHeight);this.canvas.width=t,this.canvas.height=t;const s=new m;s.add(this.params,"petals",1,10).step(1).onChange(()=>this.setupGeometry()),s.add(this.params,"width",0,1).onChange(()=>this.setupGeometry()),s.add(this.params,"numOfQuads",2,20).step(1).onChange(()=>this.setupGeometry()),s.add(this.params,"power",.01,10).step(.01).onChange(()=>this.setupGeometry())}load(){return new Promise((t,s)=>{const r=this.gl;if(r==null){const e=new Error("not initialized");s(e)}else{let e=null,a=null;h.loadFile("./shader/main.vert").then(l=>(e=h.createShaderObject(r,l,r.VERTEX_SHADER),h.loadFile("./shader/main.frag"))).then(l=>{a=h.createShaderObject(r,l,r.FRAGMENT_SHADER),this.program=h.createProgramObject(r,e,a),t()})}})}setupGeometry(){const t=this.params.numOfQuads,s=this.params.petals,r=1/t,e=[],a=[];this.positionArray=[];for(let n=0;n<s;n++){let i=2*Math.PI/s*n;for(let d=0;d<t;d++){let o=d/t;e.push([o,i,0],[o+r,i,0],[o,i,-1]),e.push([o,i,0],[o+r,i,0],[o,i,1]),e.push([o+r,i,0],[o,i,-1],[o+r,i,-1]),e.push([o+r,i,0],[o,i,1],[o+r,i,1])}}for(let n of e){const i=n[0],d=1-Math.pow(i,this.params.power);let o=n[1]+this.params.width*d*n[2];a.push([i*Math.cos(o),i*Math.sin(o),n[2]])}const l=a.length/3;for(let n=0;n<l;n++){const i=n*3,d=a[i],o=a[i+1],u=a[i+2],p=[].concat(d,o,u);this.positionArray.push(p)}this.positionStride=3,this.color=[1,0,0,1,0,1,0,1,0,0,1,1],this.colorStride=4,this.colorVBO=h.createVBO(this.gl,this.color)}setupLocation(){const t=this.gl;this.uniformLocation={time:t.getUniformLocation(this.program,"time")}}setupRendering(){const t=this.gl;t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(.3,.3,.3,1),t.clear(t.COLOR_BUFFER_BIT)}start(){this.startTime=Date.now(),this.isRender=!0,this.render()}render(){const t=this.gl;this.isRender===!0&&requestAnimationFrame(this.render),this.setupRendering();const s=(Date.now()-this.startTime)*.001;t.useProgram(this.program),t.uniform1f(this.uniformLocation.time,s);for(let r=0;r<this.positionArray.length;r++){const e=this.positionArray[r],a=h.createVBO(this.gl,e),l=t.getAttribLocation(this.program,"position"),n=t.getAttribLocation(this.program,"color");h.enableAttribute(t,a,l,this.positionStride),h.enableAttribute(t,this.colorVBO,n,this.colorStride),t.drawArrays(t.TRIANGLES,0,e.length/this.positionStride)}}}
